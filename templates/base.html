<!doctype html>
<title>Hydroponic Dashboard</title>
<head>
              <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
              <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>

</head>
<body style=background-color:black>
<button type="button" id="toggle" <span>Pump Status: <span id="pump_state"></span></span></button>
<br></br>

<style>

        .container {display: flex;
                    flex-wrap: wrap;
                    background-color: black;    
                    border-radius: 5px;
                    border: 3px outset white;
                    padding: 0px;
                    align-items: center;
                    justify-content: center;}

        .right {width: 705px; 
                height: 460px;}
        .small {height: 218px;
                flex-grow: 1;
                margin: 2px}
        .break {display: flex;
                flex-basis: 100%;
                height: 0;}

</style>


<div class="container right">
  <div class="container small" id="temp_chart">
    <script>
      var graphs = {{temp_chart | safe}};
      var layout = {{chart_layout | safe}};
      Plotly.plot('temp_chart', graphs,layout);
    </script>
  </div>
  <div class="container small" id="flow_chart">
    <script>
      var graphs = {{flow_chart | safe}};
      var layout = {{chart_layout | safe}};
      Plotly.plot('flow_chart', graphs,layout);
    </script>
  </div>
  <div class='break'></div>

  <div class="container small" id="humidity_chart">
    <script>
      var graphs = {{humidity_chart | safe}};
      var layout = {{chart_layout | safe}};
      Plotly.plot('humidity_chart', graphs,layout);
    </script>
  </div>
    <div class="container small" id="level_chart">
    <script>
      var graphs = {{level_chart | safe}};
      var layout = {{chart_layout | safe}};
      Plotly.plot('level_chart', graphs,layout);
    </script>
  </div>
</div>


</body>



<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>




  <script>

    function retrieve_data() {
      $.ajax({
        method: 'GET',
        url: {{ url_for('sensor_data')|tojson }},
        _data: $(this).serialize()
      }).done(publish_data_to_html);
    }

    function publish_data_to_html(_data) {
      var temp = JSON.parse(_data.temp_chart);
      var flow = JSON.parse(_data.flow_chart);
      var humidity = JSON.parse(_data.humidity_chart);
      var level = JSON.parse(_data.level_chart);
      console.log(level)
      var layout = _data.chart_layout;
      Plotly.newPlot('temp_chart',  temp, layout);
      Plotly.newPlot('flow_chart',  flow, layout);
      Plotly.newPlot('humidity_chart',  humidity, layout);
      Plotly.newPlot('level_chart',  level, layout);


    }








        







    function pump_click() {
      $.ajax({
        method: 'GET',
        url: {{ url_for('toggle_pump')|tojson }},
        data: $(this).serialize()
      }).done(pump_status);
    }

    function pump_status(data) {
      $('#pump_state').text(data.pump_state);
    }

    $('#toggle').click(pump_click);



$(document).ready(function(){
 setInterval(retrieve_data,3000);
});

  </script>