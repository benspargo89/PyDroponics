<!doctype html>
<title>Hydroponic Dashboard</title>
<head>
              <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
              <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>

</head>
<body style=background-color:black>
<button type="button" id="toggle" <span>Pump Status: <span id="pump_state"></span></span></button>
<br></br>

<style>

        .container {display: flex;
                    flex-wrap: wrap;
                    background-color: black;    
                    border-radius: 5px;
                    border: 3px outset white;
                    padding: 0px;
                    align-items: center;
                    justify-content: center;}

        .right {width: 705px; 
                height: 460px;}
        .small {height: 218px;
                flex-grow: 1;
                margin: 2px}
        .break {display: flex;
                flex-basis: 100%;
                height: 0;}

</style>


<div class="container right">
  <div class="container small" id="bargraph">
    <script>
      var graphs = {{plot | safe}};
      var layout = {width: 325,
                    height: 210,
                    margin: {l: 5, r:5, t:5, b:5, pad:5}};
      Plotly.plot('bargraph',graphs,layout);
    </script>
  </div>
  <div class="container small" id="bargraph2">
    <script>
      var graphs2 = {{plot2 | safe}};
      var layout = {width: 325,
                    height: 210,
                    margin: {l: 5, r:5, t:5, b:5, pad:5}};
      Plotly.plot('bargraph2',graphs2,layout);
    </script>


  </div>
  <div class='break'></div>

  <div class="container small">3</div>
  <div class="container small">4</div>
</div>


</body>



<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>




  <script>

    function retrieve_data() {
      $.ajax({
        method: 'GET',
        url: {{ url_for('sensor_data')|tojson }},
        _data: $(this).serialize()
      }).done(publish_data_to_html);
    }

    function publish_data_to_html(_data) {
      $('#temperature').text(_data.temperature);
      $('#humidty').text(_data.humidity);
      $('#graphs').text(_data.chart);
      console.log(_data.chart);
      var d = JSON.parse(_data.chart);
      var e = JSON.parse(_data.chart2);
      console.log(d)
      var layout = {width: 325,
                    height: 210,
                    margin: {l: 5, r:5, t:5, b:5, pad:5}};
      Plotly.newPlot('bargraph',  d, layout);
      Plotly.newPlot('bargraph',  e, layout);

    }








        







    function pump_click() {
      $.ajax({
        method: 'GET',
        url: {{ url_for('toggle_pump')|tojson }},
        data: $(this).serialize()
      }).done(pump_status);
    }

    function pump_status(data) {
      $('#pump_state').text(data.pump_state);
    }

    $('#toggle').click(pump_click);



$(document).ready(function(){
 setInterval(retrieve_data,3000);
});

  </script>